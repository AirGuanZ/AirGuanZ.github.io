---
title: 关于type_info和type_index的跨模块使用
key: t20211220
tags:
  - C/C++
---

<!--more-->

C++提供中的`type_info`可以提供一些关于类型的基本信息，也可以用它构建出`type_index`，用作关联容器的key。基于此，我们可以将每个类型映射为一个键值，在运行时用于判定它们是否相等。主流的`any`的实现就是基于此的。

但是，由于C++标准离实践实在太远了，以至于对动态库这种东西毫无约束，结果就是在跨动态库边界的时候，typeid的行为变得不靠谱起来。比如在`Visual Studio 2019 (v142)`工具集下，不同dll中得到的`type_info`有不同的地址，也就是说每个动态库里面都各自包含了它的一个实例。在这种情况下，`type_index`的比较还是否靠谱呢？


